<!DOCTYPE HTML>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>마이페이지 - SMART SAVING GUIDE</title>
    <link href="/css/default.css" rel="stylesheet" type="text/css" />
    <link href="/css/page.css" rel="stylesheet" type="text/css" />
    <style>
        /* 회색 배경에 이미지 추가 */
        .sub-section {
            background-image: url('/images/sub-bg3.jpg'); /* 원하는 이미지 경로로 수정 */
            background-size: cover;
            background-position: center;
            color: white;
            height: 250px; /* 원하는 높이로 설정 */
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
        }
        .search-bar {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 20px;
            padding: 10px;
        }

        .search-bar input, .search-bar select, .search-bar button {
             width: 200px; /* 원하는 너비 설정 */
             box-sizing: border-box; /* 패딩과 테두리 포함 */
        }

        .search-bar button {
            background-color: #007bff;
            color: white;
            cursor: pointer;
        }
        .grid-container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            justify-content: center;
            padding: 20px;
            max-width: 1000px;
            margin: 0 auto;
        }

        .card {
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            width: 220px;
            padding: 15px;
            text-align: center;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .card img {
            max-width: 100px;
            margin-bottom: 15px;
        }

        .product-info {
            font-size: 12px;
            text-align: left;
            width: 100%;
        }

        .product-info p {
            margin: 3px 0;
        }

        .product-info strong {
            font-weight: bold;
        }

        .favorite {
            margin-top: auto;
            padding: 8px 12px;
            background-color: #f76c6c;
            color: white;
            border-radius: 4px;
            text-decoration: none;
            display: inline-block;
        }
        .btn-primary {
    background-color: #dc3545; /* 녹색 배경 */
    color: white; /* 텍스트 색상 */
    padding: 12px 24px; /* 패딩을 늘려 버튼 크기 조정 */
    font-size: 16px; /* 폰트 크기 조정 */
    border: none; /* 테두리 제거 */
    border-radius: 5px; /* 모서리를 둥글게 */
    cursor: pointer; /* 마우스 포인터 변경 */
    transition: background-color 0.3s ease, transform 0.2s ease; /* 배경색 및 변환 효과 */
    box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.15); /* 그림자 추가 */
    }

    .btn-primary:hover {
    background-color: #c82333; /* 호버 시 더 진한 녹색 */
    transform: scale(1.05); /* 호버 시 약간 확대 효과 */
    }

    .btn-primary:active {
    background-color: #bd2130; /* 클릭 시 더 진한 색상 */
    box-shadow: 0px 2px 4px rgba(0, 0, 0, 0.2); /* 클릭 시 그림자 조정 */
    }

    </style>
</head>

<body>
<header>
    <div class="header-wrapper">
        <div class="logo">
            <a href="/login">SMART SAVING GUIDE</a>
        </div>
        <ul class="header-menu">

            <li class="nav-item"><a href="/quiz">퀴즈</a></li>
            <li class="nav-item"><a href="/favoriteCommodity">관심상품</a></li>
            <li class="nav-item"><a href="/myPage">마이페이지</a></li>
            <li class="nav-item"><a href="/logout">로그아웃</a></li>
            <li class="nav-item">
                <span th:text="${login_id} + '님 환영합니다!!'"></span>
            </li>
        </ul>
    </div>
</header>

<section class="sub-section">
    <div class="content-wrapper">
        <h2 class="sub-title">적금 추천 상품</h2>
        <p class="sub-text">고객님의 조건에 맞춘 적금 상품 추천 목록입니다</p>
    </div>
</section>

<div class="search-bar">
    <form action="/installment" method="post">
        <input type="number" id="desiredRate" name="desiredRate" placeholder="원하는 금리" step="0.01" min="0" style="margin-right: 10px;">

        <!-- 선호하는 은행 선택 -->
        <select id="preferredBank" name="preferredBank" style="margin-right: 10px;">
            <option value="">선호하는 은행 선택</option>
            <option value="하나은행">하나은행</option>
            <option value="신한은행">신한은행</option>
            <option value="IM뱅크">아이엠뱅크</option>
            <option value="국민은행">KB국민은행</option>
            <option value="IBK기업은행">IBK기업은행</option>
            <option value="NH농협은행">NH농협은행</option>
            <option value="SC제일은행">SC제일은행</option>
            <option value="Sh수협은행">수협은행</option>
            <option value="우리은행">우리은행</option>
            <option value="SBI저축은행">SBI저축은행</option>
            <option value="웰컴저축은행">웰컴저축은행</option>
            <option value="OK저축은행">OK저축은행</option>
            <option value="하나저축은행">하나저축은행</option>
            <option value="신한저축은행">신한저축은행</option>
            <option value="IBK저축은행">IBK저축은행</option>
            <option value="페퍼저축은행">페퍼저축은행</option>
            <option value="KB저축은행">KB저축은행</option>
            <option value="고려저축은행">고려저축은행</option>
            <option value="한화저축은행">한화저축은행</option>
            <option value="스마트저축은행">스마트저축은행</option>
            <option value="키움저축은행">키움저축은행</option>
            <option value="NH저축은행">NH저축은행</option>
            <option value="다올저축은행">다올저축은행</option>
            <option value="애큐온저축은행">애큐온저축은행</option>
            <option value="모아저축은행">모아저축은행</option>
            <option value="DB저축은행">DB저축은행</option>
            <option value="상상인저축은행">상상인저축은행</option>
            <option value="예가람저축은행">예가람저축은행</option>
            <option value="우리금융저축은행">우리금융저축은행</option>
            <option value="푸른저축은행">푸른저축은행</option>
            <option value="대한저축은행">대한저축은행</option>
            <option value="대신저축은행">대신저축은행</option>
            <option value="동양저축은행">동양저축은행</option>
            <option value="BNK저축은행">BNK저축은행</option>
        </select>

        <button type="submit" class="btn btn-primary">검색</button>
    </form>
</div>
<!-- 검색바 끝 -->
<div class="grid-container">
    <p th:text="${statusMessage}"></p>
    <hr style="width: 100%;">

    <div th:if="${#lists.isEmpty(status)}">
        <p>조건을 만족하는 상품이 없습니다</p>
    </div>
    <div class="card" th:each="installment, iter : ${status}">
        <div class = "logo">
            <img th:src="@{|/images/${installment.금융회사명}.png|}"
                 alt="금융회사 로고"
                 style="width: 100px; height: auto;" />
        </div>
        <div class="product-info">
            <input type="checkbox" class="favorite-checkbox" th:value="${installment.적금id}" style="margin-bottom: 10px;">
            <p><strong>상품명:</strong> <span th:text="${installment.상품명}"></span></p>
            <p><strong>가입기간:</strong>
                <span th:text="${installment.가입기간 == '제한없음' ? '제한없음' : installment.가입기간 + '개월'}"></span>
            </p>
            <p><strong>가입금액:</strong>
                <span th:text="${installment.가입금액 == '제한없음' ? '제한없음' : installment.가입금액 + '만원'}"></span>
            </p>
            <p><strong>우대조건:</strong>
                <span th:text="${#strings.isEmpty(installment.우대조건) ? '없음' : installment.우대조건}"></span>
            </p>
            <p><strong>금리:</strong> <span th:text="${installment.금리} + '%'"></span></p>
        </div>
    </div>


</div>

<div class="grid-container">
    <p th:text="${commonMessage}"></p>
    <hr style="width: 100%;">

    <div th:if="${#lists.isEmpty(install)}">
        <p>조건을 만족하는 상품이 없습니다</p>
    </div>
    <div class="card" th:each="installment, iter : ${install}">
        <div class = "logo">
            <img th:src="@{|/images/${installment.금융회사명}.png|}"
                 alt="금융회사 로고"
                 style="width: 100px; height: auto;" />
        </div>
        <div class="product-info">
            <input type="checkbox" class="favorite-checkbox" th:value="${installment.적금id}" style="margin-bottom: 10px;">
            <p><strong>상품명:</strong> <span th:text="${installment.상품명}"></span></p>
            <p><strong>가입기간:</strong>
                <span th:text="${installment.가입기간 == '제한없음' ? '제한없음' : installment.가입기간 + '개월'}"></span>
            </p>
            <p><strong>가입금액:</strong>
                <span th:text="${installment.가입금액 == '제한없음' ? '제한없음' : installment.가입금액 + '만원'}"></span>
            </p>
            <p><strong>우대조건:</strong>
                <span th:text="${#strings.isEmpty(installment.우대조건) ? '없음' : installment.우대조건}"></span>
            </p>
            <p><strong>금리:</strong> <span th:text="${installment.금리} + '%'"></span></p>
        </div>
    </div>


</div>

<div style="text-align: center; margin-top: 20px;">
    <button onclick="addToFavorites()" class="btn btn-primary">관심 목록에 추가</button>
</div>

<script>
    function addToFavorites() {
        // 선택된 체크박스의 값(installId)을 배열로 수집
        const selectedInstallIds = Array.from(document.querySelectorAll('.favorite-checkbox:checked'))
            .map(checkbox => checkbox.value);

        if (selectedInstallIds.length === 0) {
            alert("관심 목록에 추가할 상품을 선택하세요.");
            return;
        }

        // 이미 모델에서 받아온 member 객체에서 id 가져오기
        const memberId = [[${member.id}]];

        // 서버로 POST 요청 보내기
        fetch('/favorites', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ memberId: memberId, installId: selectedInstallIds })
        })
        .then(response => {
    if (response.ok) {
        return response.text().then(text => {
            if (text === "모든 상품이 관심 목록에 추가되었습니다.") {
                alert("모든 상품이 관심 목록에 추가되었습니다.");
            } else {
                alert(text);
            }
        });
    } else if (response.status === 409) {
        return response.text().then(text => {
            if (text === "일부 상품은 이미 관심 목록에 추가되어 있습니다. 나머지 상품은 정상적으로 추가되었습니다.") {
                alert("일부 상품은 이미 관심 목록에 추가되어 있습니다. 나머지 상품은 정상적으로 추가되었습니다.");
            } else if (text === "모든 상품이 관심 목록에 추가 되어 있습니다.") {
                alert("모든 상품이 관심 목록에 추가되어 있습니다.");
            }
        });
    } else {
        alert("오류가 발생했습니다. 다시 시도해 주세요.");
    }
})
        .catch(error => {
            console.error("오류:", error);
            alert("서버에 문제가 발생했습니다. 나중에 다시 시도해주세요.");
        });
    }
</script>


</body>
</html>
